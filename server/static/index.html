<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VerbaBridge Debug Console v3.0</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg: #0f172a;
        --card: #1e293b;
        --accent: #ff6b35; /* Updated to match Flutter app's deepOrange */
        --text: #f8fafc;
        --success: #22c55e;
        --warn: #f59e0b;
        --danger: #ef4444;
        --border: #334155;
      }
      body {
        font-family: "Inter", sans-serif;
        background: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .console-wrapper {
        width: 100%;
        max-width: 1000px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.5);
      }
      .header {
        background: #020617;
        padding: 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .header h1 {
        margin: 0;
        font-size: 1.5rem;
        background: linear-gradient(90deg, #ff6b35, #fca311);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .mode-tabs {
        display: flex;
        background: #0f172a;
        padding: 10px 20px 0;
        gap: 5px;
        border-bottom: 1px solid var(--border);
      }
      .mode-tab {
        padding: 12px 20px;
        color: #64748b;
        cursor: pointer;
        border-radius: 8px 8px 0 0;
        font-weight: 600;
        transition: 0.2s;
        border: 1px solid transparent;
      }
      .mode-tab:hover {
        color: white;
        background: #1e293b;
      }
      .mode-tab.active {
        background: var(--card);
        color: var(--accent);
        border: 1px solid var(--border);
        border-bottom: 1px solid var(--card);
        margin-bottom: -1px;
      }

      .controls {
        padding: 30px;
      }
      .input-section {
        display: none;
        animation: fadeIn 0.3s;
      }
      .input-section.active {
        display: block;
      }

      input[type="text"],
      select {
        width: 100%;
        padding: 15px;
        background: #0f172a;
        border: 1px solid var(--border);
        color: white;
        border-radius: 8px;
        font-size: 1.1rem;
        margin-bottom: 15px;
        font-family: "Inter", sans-serif;
        box-sizing: border-box;
      }

      .input-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
      }

      .action-btn {
        width: 100%;
        padding: 15px;
        background: var(--accent);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 800;
        font-size: 1rem;
        cursor: pointer;
        transition: 0.2s;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .action-btn:hover {
        background: #ff8c61;
        transform: translateY(-2px);
      }

      .terminal {
        background: #020617;
        border-top: 1px solid var(--border);
        padding: 20px;
        font-family: "Fira Code", monospace;
        font-size: 0.85rem;
        height: 400px;
        overflow-y: auto;
        scroll-behavior: smooth;
      }
      .log-entry {
        margin-bottom: 8px;
        padding-left: 10px;
        border-left: 2px solid transparent;
      }
      .log-info {
        border-color: #94a3b8;
        color: #94a3b8;
      }
      .log-success {
        border-color: var(--success);
        color: var(--success);
      }
      .log-error {
        border-color: var(--danger);
        color: var(--danger);
      }

      .rizzeta-card {
        background: #1e293b;
        border-left: 4px solid var(--accent);
        padding: 16px;
        margin: 12px 0;
        border-radius: 6px;
        font-family: "Inter", sans-serif;
        animation: fadeIn 0.3s ease-in-out;
      }

      .tag {
        display: inline-block;
        padding: 2px 8px;
        background: #334155;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-right: 5px;
        margin-bottom: 5px;
        color: #fca311;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="console-wrapper">
      <div class="header">
        <h1>
          VerbaBridge
          <span style="color: white; font-weight: 300">// WEB CONSOLE</span>
        </h1>
        <div
          style="
            font-size: 0.8rem;
            color: var(--success);
            border: 1px solid var(--success);
            padding: 5px 10px;
            border-radius: 20px;
          "
        >
          ● API CONNECTED
        </div>
      </div>

      <div class="mode-tabs">
        <div class="mode-tab active" onclick="ui.switchTab('analogy', this)">
          Lookup (Analogy)
        </div>
        <div class="mode-tab" onclick="ui.switchTab('live', this)">
          Live Translate
        </div>
      </div>

      <div class="controls">
        <div id="sec-analogy" class="input-section active">
          <input
            type="text"
            id="inp-slang"
            placeholder="Enter slang (e.g. 'Skibidi', 'Gostan')..."
          />

          <div class="input-row">
            <select id="inp-gen">
              <option value="Boomer">Boomer (1946–1964)</option>
              <option value="Gen X">Gen X (1965–1980)</option>
              <option value="Gen Y">Gen Y (1981–1996)</option>
              <option value="Gen Z">Gen Z (1997–2012)</option>
            </select>
            <select id="inp-vibe">
              <option value="Standard English">Standard English</option>
              <option value="Manglish">Manglish</option>
              <option value="Penang Hokkien">Penang Hokkien</option>
              <option value="Cantonese">Cantonese</option>
              <option value="Malay">Malay</option>
            </select>
          </div>

          <button class="action-btn" onclick="api.runAnalogy()">
            Generate Analogy
          </button>
        </div>

        <div id="sec-live" class="input-section">
          <input
            type="text"
            id="inp-live-text"
            placeholder="Enter a sentence with slang..."
          />

          <select id="inp-live-vibe">
            <option value="Standard English">Standard English</option>
            <option value="Manglish">Manglish</option>
            <option value="Penang Hokkien">Penang Hokkien</option>
            <option value="Cantonese">Cantonese</option>
            <option value="Malay">Malay</option>
          </select>

          <button class="action-btn" onclick="api.runLive()">
            Live Translate
          </button>
        </div>
      </div>

      <div id="terminal" class="terminal">
        <div class="log-entry log-info">
          > VerbaBridge UI v3.0 Initialized. Waiting for input...
        </div>
      </div>
    </div>

    <script>
      // --- UI CONTROLLER ---
      const ui = {
        terminal: document.getElementById("terminal"),

        log: (msg, type = "info") => {
          const div = document.createElement("div");
          div.className = `log-entry log-${type}`;
          div.innerHTML = `> ${msg}`;
          ui.terminal.appendChild(div);
          ui.terminal.scrollTop = ui.terminal.scrollHeight;
        },

        renderAnalogyCard: (data) => {
          let analogiesHtml = data.analogies
            .map((a) => `<li style="margin-bottom: 8px;">${a}</li>`)
            .join("");
          let warningHtml = data.ambiguity_warning
            ? `<div style="color: #ef4444; margin-top: 10px; font-size: 0.85rem;"><i class="fa-solid fa-triangle-exclamation"></i> Warning: ${data.ambiguity_warning}</div>`
            : "";

          const card = document.createElement("div");
          card.className = "rizzeta-card";
          card.innerHTML = `
            <div style="color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                <i class="fa-solid fa-book-open" style="color: #ff6b35;"></i> ANALOGY ENGINE (Source: ${data.source})
            </div>
            <div style="font-size: 1.5rem; color: white; font-weight: bold;">${data.slang_detected}</div>
            <div style="color: #94a3b8; font-style: italic; margin-bottom: 12px;">Literal: "${data.literal_translation}"</div>
            <div style="background: #0f172a; color: #cbd5e1; padding: 12px; font-size: 0.95rem; border-radius: 6px; border: 1px solid #334155;">
                <ul style="margin: 0; padding-left: 20px;">
                  ${analogiesHtml}
                </ul>
            </div>
            ${warningHtml}
          `;
          ui.terminal.appendChild(card);
          ui.terminal.scrollTop = ui.terminal.scrollHeight;
        },

        renderLiveCard: (data) => {
          let tagsHtml = data.highlight_words
            .map((w) => `<span class="tag">${w}</span>`)
            .join("");

          const card = document.createElement("div");
          card.className = "rizzeta-card";
          card.innerHTML = `
            <div style="color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                <i class="fa-solid fa-bolt" style="color: #ff6b35;"></i> LIVE TRANSLATE
            </div>
            <div style="font-size: 1.1rem; color: white; margin-bottom: 12px; font-weight: 600; line-height: 1.4;">
              "${data.translated_text}"
            </div>
            <div style="margin-top: 10px;">
                <span style="font-size: 0.8rem; color: #64748b; margin-right: 8px;">Slang detected:</span> ${tagsHtml || '<span style="color:#64748b; font-size:0.8rem;">None</span>'}
            </div>
          `;
          ui.terminal.appendChild(card);
          ui.terminal.scrollTop = ui.terminal.scrollHeight;
        },

        switchTab: (mode, tabElement) => {
          document
            .querySelectorAll(".mode-tab")
            .forEach((t) => t.classList.remove("active"));
          tabElement.classList.add("active");
          document
            .querySelectorAll(".input-section")
            .forEach((s) => s.classList.remove("active"));
          document.getElementById(`sec-${mode}`).classList.add("active");
          ui.log(`Switched to: ${mode.toUpperCase()}`);
        },
      };

      // --- API CONTROLLER ---
      const api = {
        runAnalogy: async () => {
          const slang_text = document.getElementById("inp-slang").value.trim();
          const user_generation = document.getElementById("inp-gen").value;
          const user_vibe = document.getElementById("inp-vibe").value;

          if (!slang_text) return ui.log("Input empty!", "error");

          ui.log(`Calling /generate_analogy for "${slang_text}"...`);
          try {
            const res = await fetch("/generate_analogy", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ slang_text, user_generation, user_vibe }),
            });
            const data = await res.json();

            if (data.status === "success") {
              ui.renderAnalogyCard(data);
              ui.log("Analogy generated successfully.", "success");
            } else {
              ui.log("Error: " + JSON.stringify(data), "error");
            }
          } catch (e) {
            ui.log("Connection error: " + e.message, "error");
          }
        },

        runLive: async () => {
          const text = document.getElementById("inp-live-text").value.trim();
          const user_vibe = document.getElementById("inp-live-vibe").value;

          if (!text) return ui.log("Input empty!", "error");

          ui.log(`Calling /live_translate for "${text}"...`);
          try {
            const res = await fetch("/live_translate", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ text, user_vibe }),
            });
            const data = await res.json();

            if (data.status === "success") {
              ui.renderLiveCard(data);
              ui.log("Live translation successful.", "success");
            } else {
              ui.log("Error: " + JSON.stringify(data), "error");
            }
          } catch (e) {
            ui.log("Connection error: " + e.message, "error");
          }
        },
      };
    </script>
  </body>
</html>
